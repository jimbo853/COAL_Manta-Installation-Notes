<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>My Docs</title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body class="homepage">
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href=".">My Docs</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#coalmanta-installation-notes" class="nav-link">COAL/Manta Installation Notes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#step-1-install-tritoncoal-on-vmware-workstation-1551" class="nav-link">Step #1: Install Triton/Coal on VMware Workstation 15.5.1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#step-2-install-manta" class="nav-link">Step #2: Install Manta</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#step-3-install-pkgin-and-node" class="nav-link">Step #3: Install pkgin and node</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="coalmanta-installation-notes">COAL/Manta Installation Notes</h1>
<p>Notes and logs detailing the installation of Manta on Triton/COAL</p>
<p>All the procedures outlined below have been tested on both Windows 10 and iMac Pro (Catalina) machines. I'll include software version numbers wherever possible as well as other requirement details such as disk and memory.</p>
<h1 id="step-1-install-tritoncoal-on-vmware-workstation-1551">Step #1: Install Triton/Coal on VMware Workstation 15.5.1</h1>
<p>https://github.com/joyent/triton/blob/master/docs/developer-guide/coal-setup.md</p>
<p>Note: The coal-setup as configured above works well with a basic installation but doesn't work with a Manta install. I'm not sure what the limit is on memory or disk but I can say that 16 GB and 400 GB does work.</p>
<p>Follow all the steps exactly down to the completion of the "Adding external Nics" step.</p>
<p>I didn't set up the "Cloud API" or "Fabrics" although I'm sure this might be worth doing eventually.</p>
<p>Also, I would recommend doing a once through the section on "Maintaining Coal" as this includes the steps for performing updates on the various sub-systems.</p>
<p>If you're doing this on VMware Workstation, I would recommend installing WinSCP to enable access (traversing, uploading, downloading, editing) to the file system through a visual interface. The required IP should be 10.88.88.200</p>
<p>Also, WinSCP provides access to a PuTTY terminal which I find to be better than VMware as a command line interface.</p>
<p>I would recommend shutting the system down manually from the command line as allowing VMware to shutdown the OS seems to cause corruption.</p>
<p>The command to shutdown gracefully is: shutdown -y -g0 -i5 halt</p>
<p>I would recommend that whenever you are restarting COAL, allow the boot to finish starting all zones before doing anything of consequence. The best way to know when the startup is complete is to check the health.</p>
<p>sdcadm health</p>
<p>... will tell you if all the zones are running without issue.</p>
<p>Finally, all this assumes that you are logging in as "root" and using the "rootpass" password as defined when you performed Step #1. </p>
<h1 id="step-2-install-manta">Step #2: Install Manta</h1>
<p>https://joyent.github.io/manta/</p>
<p>The relevant section in the "Operator's Guide" is "Deploying Manta"</p>
<p>I found installing Manta to be more difficult than installing COAL because some of the command usage was not that clear to me. As such I'll include a bit more detail in itemizing the steps below. I would still recommend reading the Op Guide as you go. The initial steps are all done from the global zone of the headnode:</p>
<p>/usbkey/scripts/setup_manta_zone.sh</p>
<p>Replace the previous with:
sdcadm post-setup manta --mantav1</p>
<p>Note: set the update channel to "dev" with:
sdcadm channel set dev</p>
<p>...then update sdcadm with:
sdcadm self-update --latest</p>
<p>/zones/$(vmadm lookup alias=manta0)/root/opt/smartdc/manta-deployment/networking/gen-coal.sh &gt; /var/tmp/netconfig.json</p>
<p>ln -s /zones/$(vmadm lookup alias=manta0)/root/opt/smartdc/manta-deployment/networking /var/tmp/networking</p>
<p>cd /var/tmp/networking</p>
<p>./manta-net.sh netconfig.json</p>
<p>The next part of the installation must be done from within the new Manta zone 0. The Op Guide doesn't make this very clear but you'll need to login to the zone, before doing any further Manta installation steps:</p>
<p>Login to manta0:</p>
<p>sdc-login manta0</p>
<p>You can logout; i.e. back to the global zone of the headnode with:</p>
<p>exit</p>
<p>Once you're logged in, the following commands should complete the basic Manta deployment:</p>
<p>(Replace the given email with your own...)</p>
<p>manta-init -s "coal" -e "your_email@gmail.com"
manta-deploy-coal</p>
<p>The manta-deploy-coal takes a long time to finish and this is where I experienced errors until I had allocated enough memory and disk within VMware prior to the initial install (Step #1).</p>
<p>When the deployment is complete, logout of the mant0 zone with "exit" </p>
<p>Once you're back into the headnode global zone, you can check the disk space allocation with:</p>
<p>zfs list zones</p>
<p>...and you can also list the Manta storage zones with:</p>
<p>manta-adm show storage</p>
<p>At this point I would recommend rebooting the system with "reboot" and after waiting until the system fully restarts and logging in again as root, you can install nodejs.</p>
<h1 id="step-3-install-pkgin-and-node">Step #3: Install pkgin and node</h1>
<p>Following login, backout to the root of the headnode with:</p>
<p>cd ../</p>
<p>acquire the package manager source with:</p>
<p>curl -k http://pkgsrc.joyent.com/packages/SmartOS/bootstrap/bootstrap-2019Q2-x86_64.tar.gz | gzcat | tar -xf -</p>
<p>.. and note that the above command is case sensitive</p>
<p>Build the code:</p>
<p>pkg_admin rebuild
pkgin -y up</p>
<p>You can now install nodejs with:</p>
<p>pkgin -y install nodejs
 .. and
pkgin -y install npm</p>
<p>.. to install the node package manager</p>
<p>I'm still having a problem getting the latest version of node installed (the previous steps install 10.6.0). In contrast we need 12.13.0</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.1.2
Build Date UTC : 2020-08-23 18:03:18.140155+00:00
-->
